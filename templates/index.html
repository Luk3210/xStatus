<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xStatus</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 20px;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }
        h1 {
            color: #333;
            transition: color 0.3s;
        }
        #editor-container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            transition: background 0.3s, box-shadow 0.3s;
        }
        label {
            display: block;
            margin-top: 16px;
            margin-bottom: 4px;
            font-weight: bold;
            text-align: left;
        }
        input[type="text"], input[type="time"], select {
            width: 95%;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            color: #222;
            transition: background 0.3s, color 0.3s, border 0.3s;
            box-sizing: border-box;
            display: block;
        }
        /* Keep the native dropdown arrow */
        select {
            /* No appearance override, so browser arrow is kept */
        }
        button {
            margin-top: 10px;
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        .darkmode-toggle {
            position: absolute;
            top: 20px;
            right: 30px;
        }
        /* Notification styles: bottom right */
        #notification {
            position: fixed;
            bottom: 35px;
            right: 35px;
            background: #28a745;
            color: #fff;
            padding: 16px 32px;
            border-radius: 6px;
            font-size: 18px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s;
            display: none;
        }
        #notification.show {
            display: block;
            opacity: 1;
            pointer-events: auto;
        }
        /* Dark mode styles */
        body.dark-mode {
            background-color: #181a1b;
            color: #e6e6e6;
        }
        body.dark-mode h1 {
            color: #f7f7f7;
        }
        body.dark-mode #editor-container {
            background: #23272b;
            box-shadow: 0 0 10px rgba(0,0,0,0.6);
        }
        body.dark-mode input[type="text"], 
        body.dark-mode input[type="time"],
        body.dark-mode select {
            background: #181a1b;
            color: #e6e6e6;
            border: 1px solid #444;
        }
        body.dark-mode button {
            background: #375a7f;
            color: #fff;
        }
        body.dark-mode button:hover {
            background: #24476a;
        }
        body.dark-mode #notification {
            background: #357d44;
            color: #e6e6e6;
        }
    </style>
</head>
<body>
    <button class="darkmode-toggle" onclick="toggleDarkMode()">🌙 Dark Mode</button>
    <h1>Configure xStatus</h1>
    <div id="editor-container">
        <form id="jsonForm" onsubmit="event.preventDefault(); saveJson();">
            <label for="xschedule_api_url">xSchedule API URL</label>
            <input type="text" id="xschedule_api_url" name="xschedule_api_url" required>

            <label for="method">Notification Method</label>
            <select id="method" name="method" required>
                <option value="discord">Discord</option>
                <option value="experimental">Experimental (No promises that this will work)</option>
            </select>

            <label for="discord_user">Discord Username</label>
            <input type="text" id="discord_user" name="discord_user" required>
            
            <label for="show_start_time">Show Start Time</label>
            <input type="time" id="show_start_time" name="show_start_time" required>
            
            <label for="show_end_time">Show End Time</label>
            <input type="time" id="show_end_time" name="show_end_time" required>
            
            <button type="submit">Save</button>
        </form>
    </div>
    <div id="notification" style="display:none;"></div>
    <script>
        // Dark mode logic
        function isDarkMode() {
            return localStorage.getItem('darkMode') === 'true';
        }
        function applyDarkMode(state) {
            if (state) {
                document.body.classList.add('dark-mode');
                document.querySelector('.darkmode-toggle').textContent = '☀️ Light Mode';
            } else {
                document.body.classList.remove('dark-mode');
                document.querySelector('.darkmode-toggle').textContent = '🌙 Dark Mode';
            }
        }
        function toggleDarkMode() {
            const dark = !isDarkMode();
            localStorage.setItem('darkMode', dark);
            applyDarkMode(dark);
        }
        document.addEventListener('DOMContentLoaded', () => {
            applyDarkMode(isDarkMode());
        });

        // Show custom notification
        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            notif.style.display = "block";
            setTimeout(() => {
                notif.classList.remove('show');
                setTimeout(() => notif.style.display = "none", 400);
            }, 2000);
        }

        // Load JSON and fill fields
        async function loadJson() {
            const response = await fetch('/get_json');
            const data = await response.json();
            document.getElementById('xschedule_api_url').value = data.xschedule_api_url || "";
            document.getElementById('method').value = data.method || "discord";
            document.getElementById('discord_user').value = data.discord_user || "";
            document.getElementById('show_start_time').value = data.show_start_time || "";
            document.getElementById('show_end_time').value = data.show_end_time || "";
        }

        // Save fields as JSON
        async function saveJson() {
            const data = {
                xschedule_api_url: document.getElementById('xschedule_api_url').value,
                method: document.getElementById('method').value,
                discord_user: document.getElementById('discord_user').value,
                show_start_time: document.getElementById('show_start_time').value,
                show_end_time: document.getElementById('show_end_time').value
            };
            await fetch('/update_json', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            showNotification('JSON updated successfully!');
        }

        loadJson();
    </script>
</body>
</html>